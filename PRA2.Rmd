---
title: 'Tipologia y Ciclo de vida de los Datos. Practica 2'
author: "Autores: Alexis Arroyo y  Gabriel Pulido de Torres"
date: "Enero 2020"
output:
  html_document:
    highlight: default
    number_sections: yes
    theme: cosmo
    toc: yes
    toc_depth: 2
    includes:
      in_header: PRA-header.html
  pdf_document:
    highlight: zenburn
    toc: yes
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(eval=T, echo=T)
```

******
# Introducción
******

En este conjunto de datos tenemos información acerca de los pasajeros que iban en el Titanic, naufragado en 1912 y en el que murieron 1500 personas. Además de información descriptiva del tipo de pasajero tenemos también el indicador de si sobrevivió al hundimiento o no. El objetivo es decidir si las variables aportadas son suficientes para crear un modelo predictivo que prediga la supervivencia o no de un pasajero.

******
# Descripción del dataset. ¿Por qué es importante y qué pregunta/problema pretende responder?
******

Primer contacto con el conjunto de datos, visualizamos su estructura.  

```{r echo=TRUE, message=FALSE, warning=FALSE}
# Cargamos los paquetes R que vamos a usar
library(ggplot2)
library(dplyr)

# Cargamos el fichero de datos
data <- read.csv('train.csv',stringsAsFactors = FALSE)
dim.data.frame(data)

# Verificamos la estructura del conjunto de datos
str(totalData)
```
El conjunto de datos incluye 12 variables y 891 observaciones.

Descripción del conjunto de datos:

Passengerld 
  Contador de pasajeros del 1 al 891.

Survived 
  esta variable toma dos valores e indica si el pasajero sobrevivió. (0= No, 1= Si).

pClass 
  clase del ticket. 1=1st (clase alta), 2=2nd (clase media) y 3=3rd (clase baja).

Name
  nombre completo del pasajero.
  
Sex
  sexo del pasajero (Female o Male).
  
Age
  edad del pasajero
  
SibSp
  número de hermanos/hermanas, hermanastros/hermanastros y marido o esposa del pasajero que también iban a bordo.

Parch
  número de hijas, hijos, padre y madre del pasajero a bordo del Titanic.
  
Ticket 
  El número del ticket del pasajero.

Fare
  Es la tarifa del pasajero en dólares.

Cabin
  Código identificativo de la cabina.
  
Embarked
  el puerto en el que embarcó el pasajero (C = Cherbourg, Q =Queenstown, S = Southampton).

## Objetivo

El objetivo es decidir si las variables aportadas son suficientes para crear un modelo predictivo que prediga la supervivencia o no de un pasajero.

# Integración y selección de los datos de interés a analizar.
******

Hemos leido los datos en un dataframe (al que llamamos "data"). Vemos su dimensionalidad, los nombres y tipos de las variables:

```{r}
dim.data.frame(data)
sapply(data, function(x) class(x))
```

Aprovechamos para comprobar si hay registros duplicados usando el comando unique()

```{r}
data_unique <- unique(data)
dim.data.frame(data_unique)
remove(data_unique)
```

Se comprueba que la dimensionalidad ha quedado exactamente igual que cuando cargamos el dataset, por lo tanto, no hay registros duplicados (nos referimos a completos duplicados).

Mostramos una muestra de los primeros registros de nuestro dataframe:

```{r}

```

Hay algunas variables que carecen de interés por ser identificativas de cada registro. Se tratan de “PassengerId”, “Ticket” y “Name”. No nos interesa tener unívocamente identificado cada caso para realizar ningún tipo de análisis, no aportan nada. 

## PersonasTicket

Antes de eliminar la variable **Ticket** nos va a servir para conocer el precio unitario que han pagado los pasajeros, ya que la variable **Fare** es la tarifa pagada en el ticket, pero dentro del mismo ticket pueden estar incluidas varias personas. Entonces, inicialmente vamos a obtener el número de personas que están incluidas en un mismo ticket.

```{r}
nrow(table(data$Ticket, data$Fare))
length(unique(data$Ticket))

data %>% group_by(Ticket, Fare) %>% filter(row_number() == 1)

```

Podemos obtener el precio por persona, dividiendo Fare / integrantes del ticket:

######################## NO encuentra PersonasTicket
```{r}
ticket_personas <- as.data.frame(data %>% group_by(Ticket) %>% dplyr::summarize(PersonasTicket-n()))
```

Creamos un nuevo dataframe (llamado "ticket_personas") con las variables **Ticket** y **PersonasTicket** 

```{r}
df_status(ticket_personas)
```

Este nuevo dataframe lo combinamos ocn nuestro dataframe original (un join) a travñes del número de ticket (variable **Ticket**) para poder incorporar el número de personas al dataframe original. Después de juntarlos eliminamos el df ticket_personas pues no lo necesitaremos.

```{r}
data <- merge(data, ticket_personas, by = "Ticket")
remove(ticket_personas)
```

Ahora tenemos en nuestro dataframe original “data” una nueva variable “PersonasTicket”. Esa variable será utilizada para dividir la tarifa del ticket “Fare” entre esta nueva columna incorporada. Con ello obtenemos una nueva variable que le llamamos “Price” y es el precio por persona que se paga en el billete (obteniendo un precio por persona lineal por billete).

```{r}
data$Price <- data$Fare / data$PersonasTicket
```

Ahora ya podemos eliminar todas las variables que no vamos a necesitar: PassengerId, Name, Ticket, PersonasTicket:

```{r}
data <- select(data, -PassengerId, -Name, -Ticket, -PersonasTicket)
```

## FamilySize

Revisando **Parch** (número de Padres / hijos a bordo) y **SibSp** (sibling: número de hermanos, hermanas, hermanastros y hermanastras  del pasajero, spouse: Marido o mujer del pasajero en el titanic ) vemos que las podemos agregar en una nueva variable **FamilySize** que será la suma de estas dos variables mas el propio viajero en cuestion. Por ello esta variable como mínimo valdra uno.

```{r}
data$FamilySize = data$SibSp + data$Parch + 1
```

## Revisión y conversion de tipos

Tenemos algunas variables que, aunque a priori aparecen como “numeric” o “character” deberíamos convertir a “factor”. Estas variables son: “Survived”, “Pclass”, “Embarked” y “Sex”.
Tienen un número finito de valores y aunque puedan ser numéricas, ese número no nos aporta información con lo que los discretizamos convirtiendolos en factores:

```{r}
data$Sex <- as.factor(data$Sex)
data$Survived <- as.factor(data$Survived)
data$Pclass <- as.factor(data$Pclass)
data$Embarked <- as.factor(data$Embarked)

```

La variable **Cabin** es de tipo character, pero como vamos a eliminarla no haremos ninguna conversión.

Finalmente nos quedarían como variables numéricas: **Age**, **SubSp**, **Parch**, **FamilySize**, **Fare** y **Price**

```{r}
summary(data)
```



# Limpieza de los datos.

## ¿Los datos contienen ceros o elementos vacíos? ¿Cómo gestionarías cada uno de estos casos?

C




## Identificación y tratamiento de valores extremos.
******
# Análisis de los datos.

## Selección de los grupos de datos que se quieren analizar/comparar (planificación de los análisis a aplicar).

## Comprobación de la normalidad y homogeneidad de la varianza.

## Aplicación de pruebas estadísticas para comparar los grupos de datos. 

En función de los datos y el objetivo del estudio, aplicar pruebas de contraste de hipótesis,
correlaciones, regresiones, etc. Aplicar al menos tres métodos de análisis diferentes.

******
# Representación de los resultados a partir de tablas y gráficas.
******
# Resolución del problema. A partir de los resultados obtenidos, ¿cuáles son las conclusiones? ¿Los resultados permiten responder al problema?



